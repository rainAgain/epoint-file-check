// jshint -W030

// 一级菜单
var FIRST_MENU_TPL='\x3cul class\x3d"first-menu l clearfix" id\x3d"firstmenu"\x3e{{#items}}\x3cli class\x3d"item-first l {{#selected}}select{{/selected}}" data-id\x3d"{{code}}" data-url\x3d"{{url}}" data-openType\x3d"{{openType}}" data-hassub\x3d"{{hasSub}}"\x3e{{name}}\x3c/li\x3e{{/items}}\x3c/ul\x3e \x3ca href\x3d"javascript:void(0)" class\x3d"menu-down {{#hideTrigger}}hidden{{/hideTrigger}} l"\x3e\x3c/a\x3e',QUICK_MENU_TPL='\x3cli class\x3d"quick-menu-item" data-code\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}"\x3e{{name}}\x3c/li\x3e',SEARCH_MENU_TPL='\x3cli class\x3d"menu-search-item" data-code\x3d"{{code}}" data-url\x3d"{{url}}" data-opentype\x3d"{{openType}}"\x3e{{{name}}}\x3c/li\x3e',BOTTOM_TAB_ITEM='\x3cli class\x3d"tabs-nav-item" id\x3d"tab-{{id}}" data-id\x3d"tab-{{uid}}" data-target\x3d"tab-content-{{id}}"\x3e\x3cspan class\x3d"tabs-nav-name" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e {{#refresh}}\x3cspan class\x3d"tabs-nav-item-refresh"\x3e\x3c/span\x3e{{/refresh}} {{#closeIcon}}\x3ci class\x3d"tabs-nav-item-close"\x3e\x3c/i\x3e{{/closeIcon}}\x3c/li\x3e',TAB_NAV_CONTENT_TPL='\x3ciframe class\x3d"tab-content hidden" id\x3d"tab-content-{{id}}" src\x3d"{{url}}" height\x3d"100%" width\x3d"100%" frameborder\x3d"0" scrolling\x3d"no"\x3e\x3c/iframe\x3e',TAB_SLIDE_TPL='\x3cli class\x3d"slide-list-item" id\x3d"tab-{{id}}" data-id\x3d"tab-{{uid}}"\x3e{{name}}\x3c/li\x3e',CONTEXT_MENU_TPL='\x3cdiv class\x3d"context-menu hidden" id\x3d"{{id}}"\x3e\x3cul\x3e{{#items}}{{#text}}\x3cli\x3e\x3ca class\x3d"menu-item" role\x3d"{{role}}" href\x3d"javascript:void(0);"\x3e\x3cspan class\x3d"item-txt"\x3e{{text}}\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e{{/text}}{{^text}}\x3cli class\x3d"sep"\x3e\x3c/li\x3e{{/text}}{{/items}}\x3c/ul\x3e\x3c/div\x3e',SKIN_TPL='\x3cdiv class\x3d"skin-choose  {{#selected}}{{selected}}{{/selected}}" data-name\x3d"{{name}}" style\x3d"background-color:{{color}}" title\x3d"{{name}}"\x3e\x3ci class\x3d"choose-skin"\x3e\x3c/i\x3e\x3c/div\x3e',LIST_TPL='{{#list}}\x3cdiv class\x3d"{{^level}}left-bar-first{{/level}} {{#level}}left-bar-extend{{/level}} bar-item extend-leve{{level}}" data-level\x3d"{{level}}" \x3e{{#tab}}\x3cul class\x3d"{{#level}}left-bar-content{{/level}} {{pid}}"\x3e{{#data}} \x3cli class\x3d"common-item" data-num\x3d"0" data-ref\x3d"{{id}}" title\x3d"{{name}}" data-name\x3d"{{name}}" data-id\x3d"{{code}}" data-haschild\x3d"{{hasChild}}" data-opentype\x3d"{{openType}}" data-url\x3d"{{url}}"\x3e{{^level}}\x3ci class\x3d"modicon-icon-left {{#icon}}{{icon}}{{/icon}}{{^icon}}modicon-1{{/icon}}"\x3e\x3c/i\x3e{{/level}} \x3cspan class\x3d"left-text"\x3e{{name}}\x3c/span\x3e{{#hasChild}}\x3ci class\x3d"icon-arrow-right"\x3e\x3c/i\x3e{{/hasChild}}\x3c/li\x3e{{/data}}\x3c/ul\x3e{{/tab}}\x3c/div\x3e{{/list}}',MSG_TPL='{{^hasHead}}\x3cdiv class\x3d"msg-category" data-code\x3d"{{code}}"\x3e\x3ch3 class\x3d"msg-category-head"data-url\x3d"{{url}}"data-title\x3d"{{name}}"\x3e\x3cspan class\x3d"msg-category-title" title\x3d"{{name}}"\x3e{{{name}}} (\x3cspan class\x3d"msg-category-num"\x3e{{num}}\x3c/span\x3e)\x3c/span\x3e\x3ci class\x3d"msg-category-remove" title\x3d"\u5ffd\u7565\u5168\u90e8"\x3e\x3c/i\x3e\x3c/h3\x3e\x3cul class\x3d"msg-list"\x3e{{/hasHead}}{{#items}}\x3cli class\x3d"msg-list-item {{#hasNew}}newmsg{{/hasNew}}" data-url\x3d"{{url}}" data-guid\x3d"{{guid}}" data-title\x3d"{{title}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"msg-item-text" title\x3d"{{title}}"\x3e{{{name}}}\x3c/span\x3e\x3cspan class\x3d"msg-item-date"\x3e{{date}}\x3c/span\x3e\x3ci class\x3d"msg-item-ignore" title\x3d"\u5ffd\u7565"\x3e\x3c/i\x3e\x3c/li\x3e{{/items}}{{^hasHead}}\x3c/ul\x3e\x3c/div\x3e{{/hasHead}}',MSG_SRH_TPL='\x3cdiv class\x3d"msg-srh-category"\x3e\x3ch4 class\x3d"msg-srh-head" data-code\x3d"{{code}}"\x3e\x3cspan class\x3d"msg-head-text"\x3e{{{name}}}\x3c/span\x3e\x3c/h4\x3e\x3cul class\x3d"msg-srh-list"\x3e{{#items}}\x3cli class\x3d"msg-srh-item" data-url\x3d"{{url}}" data-guid\x3d"{{guid}}" data-title\x3d"{{title}}" data-opentype\x3d"{{openType}}"\x3e\x3cspan class\x3d"msg-item-text" title\x3d"{{title}}"\x3e{{{resultName}}}\x3c/span\x3e\x3cspan class\x3d"msg-item-date"\x3e{{date}}\x3c/span\x3e\x3c/li\x3e{{/items}}\x3c/ul\x3e{{#hasMore}}\x3cp class\x3d"msg-srh-more"\x3e\x3ca class\x3d"msg-shr-morelink" href\x3d"javascript:void(0);" data-url\x3d"{{moreUrl}}"\x3e\u67e5\u770b\u66f4\u591a\x26gt;\x3c/a\x3e\x3c/p\x3e{{/hasMore}}\x3c/div\x3e',MSG_HISTORY_TPL='\x3cli class\x3d"msg-srh-item history" data-title\x3d"{{name}}"\x3e\x3cspan class\x3d"msg-item-text" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e\x3ci class\x3d"msg-item-remove" title\x3d"\u5220\u9664\u8bb0\u5f55"\x3e\x3c/i\x3e\x3c/li\x3e',ORG_SRH_TPL='\x3cdiv class\x3d"msg-srh-category"\x3e\x3ch4 class\x3d"msg-srh-head" data-code\x3d"{{code}}"\x3e\x3cspan class\x3d"msg-head-text"\x3e{{name}}\x3c/span\x3e\x3c/h4\x3e\x3cul class\x3d"msg-srh-list"\x3e{{#items}}\x3cli class\x3d"msg-srh-item" data-guid\x3d"{{guid}}" data-title\x3d"{{name}}"\x3e\x3ci class\x3d"msg-org-people"\x3e\x3c/i\x3e\x3cspan class\x3d"msg-item-text msg-org" title\x3d"{{name}}"\x3e{{{resultName}}}\x3c/span\x3e\x3ci class\x3d"msg-org-email" title\x3d"\u53d1\u9001\u90ae\u4ef6"\x3e\x3c/i\x3e\x3ci class\x3d"msg-org-emsg" title\x3d"\u53d1\u9001\u6d88\u606f"\x3e\x3c/i\x3e\x3c/li\x3e{{/items}}\x3c/ul\x3e\x3c/div\x3e',ORG_HISTORY_TPL='\x3cli class\x3d"msg-srh-item history" data-title\x3d"{{name}}"\x3e\x3ci class\x3d"msg-org-people"\x3e\x3c/i\x3e\x3cspan class\x3d"msg-item-text" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e\x3ci class\x3d"msg-item-remove" title\x3d"\u5220\u9664\u8bb0\u5f55"\x3e\x3c/i\x3e\x3c/li\x3e',EMSG_RECENT_TPL='{{#items}}\x3cli class\x3d"emsg-recent-item {{^hasRead}}newmsg{{/hasRead}}" data-sessionid\x3d"{{sessionId}}" data-uid\x3d"{{uid}}" data-type\x3d"{{type}}"\x3e\x3cdiv class\x3d"emsg-user-img"\x3e\x3cimg src\x3d"{{imgUrl}}" onerror\x3d"this.onerror\x3d\'\';this.src\x3d\'../emsg/images/emsg-user-error.jpg\';" /\x3e\x3c/div\x3e\x3cdiv class\x3d"emsg-recent-record"\x3e\x3ch2\x3e\x3cspan class\x3d"emsg-user-name" title\x3d"{{name}}"\x3e{{name}}\x3c/span\x3e{{^hasRead}}\x3ci class\x3d"emsg-not-read"\x3e\x3c/i\x3e{{/hasRead}}\x3cspan class\x3d"emsg-recent-date"\x3e{{date}}\x3c/span\x3e\x3c/h2\x3e\x3cp class\x3d"emsg-recent-message"\x3e{{message}}\x3c/p\x3e{{^hasRead}} \x3cspan class\x3d"emsg-ignore-icon"\x3e\u5ffd\u7565\x3c/span\x3e{{/hasRead}}\x3c/div\x3e\x3c/li\x3e{{/items}}',$topMenu=$("#top-menu"),$quickMenu=$("#quick-menu"),$leftContainer=$("#left-menu"),$pageCover=$("#page-cover"),$msgPanel=$("#msg-panel"),$dropBox=$("#bottom-drop"),$dropPanel=$("#bottom-slide-box"),$userInfo=$("#top-user"),$bgImg=$("#bg-img"),_getNiceSroll_xhr,_getNiceSroll_cbs=[],_getNiceSroll_=function(c){$.fn.niceScroll?c():(_getNiceSroll_xhr||(_getNiceSroll_xhr=Util.ajax({url:"/fui/js/lib/jquery.nicescroll.min.js",dataType:"script"}).done(function(){for(var a=0,d=_getNiceSroll_cbs.length;a<d;a++)_getNiceSroll_cbs[a]();_getNiceSroll_cbs=[]})),_getNiceSroll_cbs.push(c))},_toolbar_xhr,_toolbar_cbs=[],_toolBar_=function(c){$.ToolBar?c():(_toolbar_xhr||(_toolbar_xhr=Util.ajax({url:"/fui/js/lib/toolbar.js",dataType:"script"}).done(function(){for(var a=0,d=_toolbar_cbs.length;a<d;a++)_toolbar_cbs[a]();_toolbar_cbs=[]})),_toolbar_cbs.push(c))},loadBgImg=function(c){var a=new Image;a.src=c;a.onload=function(){$bgImg[0].src=c}};(function(c,a){var d=a("#logo-img");a("#head-img");a("#drop-head-img");var g=function(){$userInfo.removeClass("showPanel");$pageCover.addClass("hidden")};$userInfo.on("click",".head-img",function(){$userInfo.hasClass("showPanel")?g():($userInfo.addClass("showPanel"),$pageCover.removeClass("hidden"))}).on("click",".setting-item",function(){var e=a(this).data("target");TabsNav.addTab(h[e]);g()}).on("click",".loginout",function(){mini.confirm("\u60a8\u786e\u5b9a\u8981\u9000\u51fa\u7cfb\u7edf\u5417\uff1f","\u7cfb\u7edf\u63d0\u793a",function(a){"ok"==a&&(eMsgSocket&&eMsgSocket.close(),UserSettins.logout())});g()}).on("click",".role-change",function(){g();UserSettins.changeRole(_userGuid_)});var h={personal:{name:"\u4e2a\u4eba\u8d44\u6599",url:UserSettins.datum,id:"personal-datum"},page:{name:"\u754c\u9762\u914d\u7f6e",url:UserSettins.interfaceUrl,id:"personal-interface"},"function":{name:"\u529f\u80fd\u914d\u7f6e",url:UserSettins.functionUrl,id:"personal-function"}},k=function(a,f){var b=new Image;b.onload=function(){f.src=a};b.onerror=function(){console.error(a+"\u5bf9\u5e94\u7684\u56fe\u7247\u8d44\u6e90\u65e0\u6cd5\u52a0\u8f7d\uff01")};b.src=a};Util.ajax({type:"POST",dataType:"json",url:UserSettins.userInfo,data:{query:"init-header"}}).done(function(e){c._userName_=e.userName;c._userGuid_=e.userGuid;eMsgSocket=new EMsgSocket(_userGuid_,_userName_);var f=e.title,b=e.homeName,m=e.homeUrl,p=e.bgImg;f&&(document.title=f,c.systemTitle=f);k(Util.getRightUrl(e.logoImg||c.DEFAULT_LOGO_URL),d[0]);p&&loadBgImg(Util.getRightUrl(p));f=[];c.FixedTabs&&0!==FixedTabs.length?f=FixedTabs:b&&m&&f.push({id:"home",name:b,url:m});a.each(f,function(a,b){TabsNav.addTab({id:b.id||"home-"+a,url:b.url,name:b.name,closeIcon:!1,refresh:!0},!1)});e.hasParttime&&$userInfo.find(".cancel-out").addClass("hasRoles");b=a(".user-txt");b.find(".username").text(_userName_);e.ouName&&b.find(".departname").text(e.ouName)})})(this,jQuery);(function(c,a){$topMenu.on("click",".item-first",function(){var e=a(this),f=e.data("id"),b=e.data("url"),m=e.data("hassub"),d=e.text(),g=e.data("opentype");e.addClass("select").siblings().removeClass("select");b&&("tabsnav"===g?TabsNav.addTab({id:f,name:d,url:b}):(c.open(Util.getRightUrl(b),f),e.removeClass("select")));m?c.getLeftMenu(f,d):c.hideLeftMenu();$topMenu.hasClass("showPanel")&&($topMenu.removeClass("showPanel"),$pageCover.addClass("hidden"))}).on("click",".menu-down",function(){$topMenu.hasClass("showPanel")?($topMenu.removeClass("showPanel"),$pageCover.addClass("hidden")):($topMenu.addClass("showPanel"),$pageCover.removeClass("hidden"))});var d,g;a(c).on("resize.topMunu",function(){clearTimeout(g);g=setTimeout(function(){var a=$topMenu.find(".item-first").length,f=$topMenu.find("#firstmenu").width();95*a>f?d.removeClass("hidden"):d.addClass("hidden")},200)});var h=function(a){(Util.browsers.isIE8||Util.browsers.isIE67)&&setTimeout(k,20);return 1800<=a?10:1500<=a?8:5},k=function(){a(c).off("resize.topMunu");var e=a(c).width();1800<=e?$topMenu.css({width:"994px","margin-left":"-497px"}).find("#firstmenu").css({width:"950px"}):1500<=e&&$topMenu.css({width:"804px","margin-left":"--402px"}).find("#firstmenu").css({width:"760px"})};Util.ajax({type:"POST",dataType:"json",url:Menu.topMenu,data:{query:"init-sidebarNav-top"}}).done(function(e){a(e).each(function(a,b){b.openType=b.isBlank?"blank":"tabsnav"});var f={items:[]};f.items=e;e=f.code;var b="",m;if(e)for(var g=0,k=f.items.length;g<k;g++){var l=f.items[g];if(l.code==e){l.selected=!0;b=l.name;m=l.hasSub;break}}else f.items[0].selected=!0,e=f.items[0].code,b=f.items[0].name,m=f.items[0].hasSub;f.items.length<=h(a(c).width())&&(f.hideTrigger=!0);f=Mustache.render(FIRST_MENU_TPL,f);$topMenu.html(f);d=$topMenu.find(".menu-down");m&&c.getLeftMenu(e,b)})})(this,jQuery);(function(c,a){var d=a(".quick-menu-panel",$quickMenu),g=a(".quick-menu-list",$quickMenu);$quickMenu.on("click",".quick-menu-title",function(){$quickMenu.hasClass("open")||($quickMenu.addClass("open"),$pageCover.removeClass("hidden"))}).on("click",".quick-menu-item",function(){var e=a(this),f=e.data("url"),b=e.data("code"),d=e.text(),e=e.data("opentype");f&&("tabsnav"===e?TabsNav.addTab({url:f,name:d,id:b}):c.open(Util.getRightUrl(f),b));h()}).on("click",".quick-menu-btn",function(){a(this).hasClass("edit")?(TabsNav.addTab({id:"editNav",name:"\u5feb\u6377\u83dc\u5355",url:QuickNav.editUrl}),h()):k()});var h=function(){$quickMenu.removeClass("open");$pageCover.addClass("hidden")},k=function(){Util.ajax({type:"POST",dataType:"json",url:QuickNav.quickNav}).done(function(a){if(a&&a.length){for(var f=[],b=0,e=a.length;b<e;b++)a[b].openType=a[b].isBlank?"blank":"tabsnav",f.push(Mustache.render(QUICK_MENU_TPL,a[b]));d.removeClass("empty");g.html(f.join(""))}else d.addClass("empty"),g.empty()})};k();_getNiceSroll_(function(){g.niceScroll({cursorcolor:"#2590cc",cursorborder:"1px solid #d5dee6",cursorwidth:"3px"})})})(this,jQuery);(function(c,a){c.leftMenuStatus={};var d=$leftContainer.find(".left-menu-wrap"),g=$leftContainer.find(".name-txt"),h={};c._leftIsWide=!1;$leftContainer.on("click",".icon-triggle",function(){$leftContainer.hasClass("wide")?($leftContainer.find(".top-item").removeClass("open"),$leftContainer.removeClass("wide"),a.cookie("_leftStatus_","narrow",{expires:30}),$pageCover.addClass("hidden"),_leftIsWide=!1,_toolBar_(function(){a.ToolBar({leftBar:"#left-menu-"+a(this).data("code"),slideIn:"slide-off-in-",slideOut:"slide-off-out-"})})):($leftContainer.addClass("wide"),a.cookie("_leftStatus_","wide",{expires:30}),_leftIsWide=!0,_toolBar_(function(){a.ToolBar({leftBar:"#left-menu-"+a(this).data("code")})}));TabsNav.adjustSize()});a(function(){"wide"==(a.cookie("_leftStatus_")||"wide")?($leftContainer.addClass("wide"),_leftIsWide=!0):($leftContainer.removeClass("wide"),_leftIsWide=!1)});$leftContainer.on("click",".common-item",function(){var f=a(this);f.parent(".left-menu-item");f.siblings(".left-menu-sub");var b=f.data("url");if(b){var e=f.data("opentype"),d=f.attr("title");"blank"==e?c.open(Util.getRightUrl(b),d):TabsNav.addTab({id:f.data("id"),name:d,url:b})}});var k=function(a){var b=0,f=function(a,e){a.forEach(function(a,d){a.hasChild=!(!a.items||!a.items.length);a.openType=a.isBlank?"blank":"tabsnav";a.rowkey=void 0===e?d+"":e+"-"+d;var g=a.rowkey.split("-").length;g>b&&(b=g);a.hasChild&&f(a.items,a.rowkey)})};f(a);var e=0,d=[],g=function(a){var f=[];if(0==e){for(var m=[],c=0,k=a.length;c<k;c++)a[c].id="w_"+c,m.push(a[c]);f.push({pid:"",data:m})}else if(e<b)for(c=0,k=a.length;c<k;c++)for(var h=0,m=a[c].data.length;h<m;h++)a[c].data[h].items&&(a[c].data[h].items.forEach(function(b,f){b.id=a[c].data[h].id+"_c_"+f}),f.push({pid:a[c].data[h].id,data:a[c].data[h].items}));else return;e+=1;d.push({level:e-1,tab:f});g(f)};g(a);Mustache.parse(LIST_TPL);return Mustache.render(LIST_TPL,{list:d})},e=function(f,b){var e="";if(f&&f.length){var e=k(f),c=a('\x3cul id\x3d"left-menu-'+b+'" class\x3d"left-menu-list"\x3e\x3c/ul\x3e');a(".icon-triggle",$leftContainer).data("code",b);c.append(Util.clearHtml(e)).appendTo(d).siblings(".left-menu-list").addClass("hidden");_getNiceSroll_(function(){a(".bar-item",d).niceScroll({cursorcolor:"#2590cc",cursorborder:"1px solid #d5dee6",cursorwidth:"3px"})});"wide"==(a.cookie("_leftStatus_")||"wide")?_toolBar_(function(){a.ToolBar({leftBar:"#left-menu-"+b})}):_toolBar_(function(){a.ToolBar({leftBar:"#left-menu-"+b,slideIn:"slide-off-in-",slideOut:"slide-off-out-"})})}};c.getLeftMenu=function(a,b){$leftContainer.removeClass("noleft");g.text(b);h[a]?($leftContainer.find("#left-menu-"+a).removeClass("hidden").addClass("active").siblings(".left-menu-list").addClass("hidden").removeClass("active"),$leftContainer.find("common-item").removeClass("active")):(h[a]="waiting",Util.ajax({type:"POST",dataType:"json",url:Menu.topMenu,data:{query:"init-sidebarNav-sub",moduleCode:a}}).done(function(b){h[a]=!0;e(b,a)}).fail(function(){h[a]=!1}))};c.hideLeftMenu=function(){$leftContainer.addClass("noleft")}})(this,jQuery);(function(c,a){var d={id:!1,items:[{text:"",role:"",icon:"",click:Util.noop}],selector:!1},g=Mustache,h=a.trim(CONTEXT_MENU_TPL);c.ContextMenu=function(c){this.cfg=a.extend({},d,c);this._init()};ContextMenu.prototype={constructor:ContextMenu,_init:function(){this.cfg.options={};this._initView();this._initEvent()},_getSize:function(){var a=this.$widget,e;a.addClass("hidden-accessible").removeClass("hidden");e={width:a.outerWidth(),height:a.outerHeight()};a.addClass("hidden").removeClass("hidden-accessible");return e},_initView:function(){var d=this.cfg;d.id||(d.id=Util.uuid(8,16)+"-contextmenu");this.$widget=a(Util.clearHtml(g.render(h,d))).appendTo("body");this.size=this._getSize()},_initEvent:function(){var d=this.cfg,e=this,f={},b;a.each(d.items,function(a,b){f[b.role]=b.click});this.$widget.on("click",".menu-item",function(b){b.preventDefault();var c=this.getAttribute("role"),c=f[c],g;c&&(g=a.proxy(c,e,d.options,b)());!1!==g&&e.hide()});a(document).on("click",function(b){a.contains(e.$widget[0],b.target)||e.hide()});d.selector&&(b=a(d.selector),b.length&&b.on("contextmenu",function(a){e.show({x:a.pageX,y:a.pageY});return!1}))},hide:function(){this.$widget.addClass("hidden");return this},show:function(a){this.$widget.css({top:a.x,left:a.y,zIndex:Util.getZIndex()}).removeClass("hidden");return this},setOptions:function(a,d){this.cfg.options[a]=d;return this}}})(this,jQuery);(function(c,a){var d=a("#all-tabs-list"),g=a("#tabs-list"),h=g.find(".bottom-tab-line"),k=a("#tabs-fixed-list"),e=a("#maincontent"),f=$dropPanel.find(".slide-list"),b=a.trim(BOTTOM_TAB_ITEM),m=a.trim(TAB_NAV_CONTENT_TPL),p=a.trim(TAB_SLIDE_TPL),t=Mustache,l={},u={},w="",z={closeIcon:!0,refresh:!1},n=a("#footer").width()-40-k.outerWidth(!0)-1;c.TabsNav={_tab_w:0,_activeId:"",_getTabWidth:function(){this._tab_w||(this._tab_w=k.children().eq(0).outerWidth(!0)||115);return this._tab_w},addTab:function(r,d){var c=a.extend({},z,r),g="tab-"+c.id;if(!l[g]){d?(c.realUrl=Util.getRightUrl(c.url),c.url="about:blank"):c.url=Util.getRightUrl(c.url);c.uid=c.id;var v=Util.clearHtml(t.render(b,c));c.closeIcon?(a(v).appendTo(h),v=a.extend({},c),v.id+="-drop",a(Util.clearHtml(t.render(p,v))).appendTo(f)):(a(v).appendTo(k),u[g]=!0,w=g);a(Util.clearHtml(t.render(m,c))).appendTo(e);l[g]=c;d&&(l[g].notInit=!0);this.adjustSize()}d||this.activeTab(g)},getActiveTab:function(){var a=$allTabs.find("#"+this._activeId);return new q(l[a[0].id])},activeTab:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b);if(c.length){var e=a("#"+c.data("target")),r=l[b];u[b]||this.adjustTabPosOnActive(b);c.hasClass("active")||(d.find("li.active").removeClass("active"),c.addClass("active"),this._activeId=b,r.notInit&&(e[0].src=r.realUrl,r.notInit=!1),e.removeClass("hidden").siblings(".tab-content").addClass("hidden"))}},adjustTabPosOnActive:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b).prevAll();b=this._getTabWidth();var d=Math.ceil(Math.abs(parseFloat(h.css("margin-left"),10))),e=d,c=b*c.length;c<d?e=c:c>=n+d?e=c+b-n:c>d&&c<n+d&&c+b>n+d&&(e=c+b-n);h.stop(!0).animate({marginLeft:-e},500)},removeTab:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b),d=a("#"+c.data("target"));c.hasClass("active")&&(c.prev().length?this.activeTab(c.prev()[0].id):c.next().length?this.activeTab(c.next()[0].id):this.activeTab(w));c.remove();f.find("#"+b+"-drop").remove();Util.clearIframe(d);d.remove();delete l[b];this.adjustSize()},removeAll:function(a){a&&0!==a.indexOf("tab-")&&(a="tab-"+a);h.find(".tabs-nav-item").each(function(b,c){var d=c.id;d!=a&&TabsNav.removeTab(d)});a||TabsNav.activeTab(w)},adjustSize:function(){n=a("#footer").width()-40-k.outerWidth(!0)-1;var b=this._getTabWidth()*h.children().length+1;0<b&&h.css("width",b);n>b?(h.stop(!0).animate({marginLeft:0},500),g.css("width","auto")):(b-=n,h.stop(!0).animate({marginLeft:-b},500),g.css("width",n))},refreshTabContent:function(b){0!==b.indexOf("tab-")&&(b="tab-"+b);var c=a("#"+b),c=a("#"+c.data("target"));c[0].src="about:blank";c[0].src=Util.getRightUrl(l[b].realUrl||l[b].url)}};var q=function(a){this._data=a};a.extend(q.prototype,{remove:function(){var a="tab-"+this._data.id;u[a]?console&&console.warn("\u8b66\u544a\uff1a\u56fa\u5b9aTab\u662f\u4e0d\u80fd\u5220\u9664\u7684\uff01"):TabsNav.removeTab(a)},getData:function(){var b=this._data;return a.extend({},b,{tabId:"tab-"+b.id})},refreshContent:function(){TabsNav.refreshTabContent("tab-"+this._data.id)},active:function(){TabsNav.activeTab("tab-"+this._data.id)},prev:function(){var b=a("#tab-"+this._data.id).prev();if(b.length)return new q(l[b[0].id]);console&&console.warn("\u5df2\u7ecf\u5230\u5934\u4e86\uff01")},next:function(){var b=a("#tab-"+this._data.id).next();if(b.length)return new q(l[b[0].id]);console&&console.warn("\u5df2\u7ecf\u5230\u5c3e\u4e86\uff01")}});var x;a(c).on("resize",function(a){clearTimeout(x);x=setTimeout(function(){TabsNav.adjustSize();TabsNav.activeTab(TabsNav._activeId)},200)});d.on("click",".tabs-nav-item",function(a){TabsNav.activeTab(this.id)}).on("click",".tabs-nav-item-close",function(a){a=this.parentNode.getAttribute("data-id");TabsNav.removeTab(a)}).on("click",".tabs-nav-item-refresh",function(a){a.stopPropagation();a=this.parentNode.getAttribute("data-id");TabsNav.refreshTabContent(a)}).on("contextmenu",".tabs-nav-item",function(b){b=this.id;if(!u[b]){var c=a(this),d=c.offset().top+68,c=c.offset().left+3;A.setOptions("tabId",b).show({x:d,y:c});return!1}});$dropPanel.on("click",".slide-list-item",function(a){a=this.getAttribute("data-id");TabsNav.activeTab(a);y()});$dropBox.on("click",".drop-btn",function(a){y()});var y=function(){$dropBox.hasClass("showPanel")?($dropPanel.stop(!0).animate({bottom:-$dropPanel.height()}),$pageCover.addClass("hidden")):($dropPanel.stop(!0).animate({bottom:30}),$pageCover.removeClass("hidden"));$dropBox.toggleClass("showPanel")},A=new ContextMenu({items:[{text:"\u5173\u95ed",role:"close-self",click:function(a){TabsNav.removeTab(a.tabId)}},{icon:"remove",text:"\u5173\u95ed\u5176\u4ed6\u9875",role:"close-others",click:function(a){TabsNav.removeAll(a.tabId)}},{icon:"remove",text:"\u5173\u95ed\u5168\u90e8",role:"close-all",click:function(a){TabsNav.removeAll()}},{text:"\u5237\u65b0",role:"refresh-self",click:function(a){TabsNav.refreshTabContent(a.tabId)}},"sep",{text:"\u53d6\u6d88",role:"quit",click:function(a){}}]});_getNiceSroll_(function(){$dropPanel.niceScroll({cursorcolor:"#d5dee6"})})})(this,jQuery);(function(c,a){a("body").on("click",function(c){c=a(c.target);var d=!0;a.contains($userInfo[0],c[0])?(hidePanel(),d=!1):$userInfo.removeClass("showPanel");a.contains($topMenu[0],c[0])?d=!1:$topMenu.removeClass("showPanel");a.contains($quickMenu[0],c[0])?d=!1:$quickMenu.removeClass("open");c.closest(".bottom-drop").length?d=!1:($dropBox.removeClass("showPanel"),$dropPanel.stop(!0).animate({bottom:-$dropPanel.height()}));a.contains($msgPanel[0],c[0])||c.closest(".js-panel").length?d=!1:hidePanel();_leftIsWide||(c.closest(".left-menu").length?d=!1:$leftContainer.find(".top-item.open").removeClass("open"));d&&$pageCover.addClass("hidden")})})(this,jQuery);(function(c,a){var d=function(){a("[placeholder]").placeholder()};a.placeholder?d():Util.loadJs("fui/js/lib/jquery.placeholder.min.js",d)})(this,jQuery);(function(c,a){a("#rightMessage");var d=a("#top-right-content"),g=a(".top-right",d),h=a(".remind-num",g),k=a(".remind-msg-num",g),d=a("#msgRemind",$msgPanel),e=a(".msg-panel-content",d),f=a(".msg-panel-result",d);a(".msg-result-content",f);d=a(".msg-panel-history",d);a(".msg-history-list",d);var d=a("#msg-sound"),b,m;Util.browsers.isIE?b=a('\x3ciframe src\x3d"" frameborder\x3d"0" class\x3d"hidden" id\x3d"msgcenter-sound"\x3e\x3c/iframe\x3e').appendTo(d):(d.html('\x3caudio id\x3d"msgcenter-sound-audio" controls\x3d"controls" src\x3d"../msgsound/newsms.wav" class\x3d"hidden-accessible"\x3e\x3c/audio\x3e'),m=document.getElementById("msgcenter-sound-audio"));var p=Mustache,t=a.trim(MSG_TPL);a.trim(MSG_SRH_TPL);a.trim(MSG_HISTORY_TPL);var l=function(a){a=parseInt(a);return 99<a?"99+":0>=a?"":a+""},u=function(){Util.ajax({url:MsgNumUrl,dataType:"json",type:"POST",data:{query:"get-msgNum"}}).done(function(a){var c=!1;a.msgRemindNum?(c=!0,h.text(l(a.msgRemindNum))):h.text("");a.msgEMsgNum?(c=!0,k.text(l(a.msgEMsgNum))):k.text("");c?(Util.browsers.isIE?b[0].src=Util.getRightUrl(SOUND_URL+"?_\x3d"+ +new Date):m.play(),docTitle.roll()):docTitle.stop()})},w=function(b){var c=[];b.length?a.each(b,function(b,d){d.num=l(d.num);a.each(d.items,function(a,b){b.title=b.name.replace(/<[^>]+>/g,"")});c.push(p.render(t,d))}):c.push('\x3cspan class\x3d"msg-content-empty"\x3e\u6ca1\u6709\u65b0\u6d88\u606f\x3c/span\x3e');a(Util.clearHtml(c.join(""))).appendTo(e.empty())},z=function(b,c){b.items&&b.items.length?(b.hasHead=!0,a.each(b.items,function(a,b){b.title=b.name.replace(/<[^>]+>/g,"")}),a(Util.clearHtml(p.render(t,b))).appendTo(c.empty()),c.prev().find(".msg-category-num").text(l(b.num))):c.parent().remove()},n=function(a,b){Util.ajax({url:MsgRemind.ignoreUrl,dataType:"json",type:"POST",data:{query:"ignore-msgRemind",code:a,guid:b||""}}).done(function(b){var c=e.find('[data-code\x3d"'+a+'"]').children(".msg-list");z(b,c);b.msgRemindNum?h.text(l(b.msgRemindNum)):h.text("")})};c.hidePanel=function(){$msgPanel.stop(!0).animate({right:-350},function(){$msgPanel.addClass("hidden")});g.find(".active").removeClass("active")};var q=function(a){"popdiv"==a.openType?epoint.openDialog(a.name,a.url,null):"newwindow"==a.openType?c.open(Util.getRightUrl(a.url)):TabsNav.addTab({id:a.id,name:a.name,url:a.url});hidePanel()},x=!1,y=function(a,b){mini.showMessageBox({title:"\u7cfb\u7edf\u63d0\u793a",message:"\u5ffd\u7565 "+a+" \u4e0b\u7684\u6240\u6709\u672a\u8bfb\u6d88\u606f\uff1f",buttons:["ok","cancel"],iconCls:"mini-messagebox-question",showNoTipCheck:!0,clickNoTipCheck:function(a){x=a},callback:function(a){"ok"==a&&n(b)}})};g.on("click",".js-panel",function(b){b.stopPropagation();b=a(this);var c=b.data("ref"),d=a("#"+c,$msgPanel);b.hasClass("active")?hidePanel():(b.addClass("active").siblings(".active").removeClass("active"),"msgRemind"==c?Util.ajax({url:MsgRemind.getUrl,dataType:"json",type:"POST",data:{query:"get-msgRemind-data"}}).done(w):"msgEMsg"==c&&B(),d.removeClass("hidden").siblings().addClass("hidden"),$msgPanel.removeClass("hidden"),$msgPanel.animate({right:0}),$pageCover.removeClass("hidden"))});_getNiceSroll_(function(){a([e,$msgEMsgContent]).each(function(a,b){b.niceScroll({cursorcolor:"#ccc",cursorborder:"1px solid #d5dee6",cursorwidth:"3px"})})});e.on("click",".msg-category-title",function(){var b=a(this).parent(),c=b.data("title"),d=b.data("url"),b=b.parent().data("code");q({id:b,name:c,url:d})}).on("click",".msg-category-remove",function(){var b=a(this).closest(".msg-category"),c=b.data("code"),b=b.children(".msg-category-head").data("title");x?n(c):y(b,c)}).on("click",".msg-list-item",function(){var b=a(this),c=b.data("title"),d=b.data("url"),e=b.data("guid"),b=b.data("opentype");q({id:e,name:c,url:d,openType:b})}).on("click",".msg-item-ignore",function(b){b.stopPropagation();var c=a(this).parent();b=c.data("guid");c=c.closest(".msg-category").data("code");n(c,b)});var d=a("#msgEMsg",$msgPanel),A=a("a[data-ref\x3d'msgEMsg']",g);$msgEMsgContent=a(".msg-panel-content",d);$msgEMsgRecent=a(".emsg-recent-list",$msgEMsgContent);$msgEMsgResult=a(".msg-panel-result",d);$msgEMsgResultContent=a(".emsg-recent-list",$msgEMsgResult);$msgEMsgHistory=a(".msg-panel-history",d);$msgEMsgHistoryContent=a(".msg-history-list",$msgEMsgHistory);var r=a.trim(EMSG_RECENT_TPL),D=function(b){b&&b.sessionlist.length&&(b=a.map(b.sessionlist,function(a,b){"friend"===a.type&&""==a.imgUrl&&(a.imgUrl=EmsgConfig.userImg);"group"===a.type&&(a.imgUrl=EmsgConfig.groupImg);a.message=a.message.replace(/<[^>]+>/g,"").replace(/&nbsp;/ig,"");return a}),b=p.render(r,{items:b}),a(Util.clearHtml(b)).appendTo($msgEMsgRecent.empty()))},B=function(){if(!A.hasClass("active"))return!1;Util.ajax({url:EmsgConfig.baseUrl,data:{query:"loadrecentsession"}}).done(D)};c.RefreshEMsg=B;var C=function(){var a=k.text();a&&(a=parseInt(a)-1);0==a&&(a="");k.text(a)};$msgEMsgRecent.on("click",".emsg-ignore-icon",function(b){b.stopPropagation();a(this).closest("div").find(".emsg-not-read").remove();b=a(this).closest("li").removeClass("newmsg").data("sessionid");Util.ajax({url:EmsgConfig.baseUrl,data:{query:"ignoremessage",sessionid:b}});C();a(this).remove()}).on("click",".emsg-recent-item",function(b){b.stopPropagation(b);a(this).removeClass("newmsg");b=a(this).find(".emsg-not-read,.emsg-ignore-icon");var c=a(this).data("sessionid"),d=a(this).data("uid"),e=a(this).data("type");b.length&&(b.remove(),C());hidePanel();OpenEMsg(c,d,e)});$msgEMsgResultContent.on("click",".emsg-recent-item",function(){var b=a(this).data("sessionid"),c=a(this).data("uid"),d=a(this).data("type");hidePanel();OpenEMsg(b,c,d)});$msgPanel.on("click",".msg-panel-hide",function(){hidePanel()});a(function(){u()})})(this,jQuery);var eMsg,eMsgSocket;function EMsgSocket(c,a){var d=atmosphere,g,h="websocket",k={url:EmsgConfig.websocketUrl,contentType:"application/json",transport:h,reconnectInterval:5E3,headers:{uid:c,uname:a},onTransportFailure:function(a,c){h=c.fallbackTransport="long-polling"},onMessage:function(a){a=a.responseBody;try{if("long-polling"==h){a="["+a.replace(/}{/g,"},{")+"]";var b=atmosphere.util.parseJSON(a);$.each(b,function(a,b){e(b)})}else b=atmosphere.util.parseJSON(a),e(b)}catch(p){}}},e=function(a){"messagecount"==a.type?NewMessageRemind(a):"remotelogin"==a.type?epoint.alert(a.message,"\u7cfb\u7edf\u63d0\u793a",function(a){UserConfig.onLogout&&(eMsgSocket&&eMsgSocket.close(),UserConfig.onLogout())}):(eMsg&&eMsg.receiveMessage(a),eMsg&&"max"==eMsg.status()||"message"==a.type&&MsgNotify(a),-1<$.inArray(a.type,["message","creategroup","joingroup"])&&RefreshEMsg())},f=function(a){mini.showTips({content:a,state:"danger",x:"center",y:"center",timeout:2E3})};k.onClose=function(a){EmsgConfig.showErrorMsg&&setTimeout(function(){f(EmsgConfig.closeMsg||"E\u8baf\u5df2\u65ad\u5f00\u8fde\u63a5\uff0c\u8bf7\u5c1d\u8bd5\u91cd\u65b0\u767b\u5f55\uff01")},3E3)};k.onError=function(a){EmsgConfig.showErrorMsg&&setTimeout(function(){f(EmsgConfig.errorMsg||"E\u8baf\u8fde\u63a5\u51fa\u73b0\u9519\u8bef\uff0c\u8bf7\u8054\u7cfb\u7ba1\u7406\u5458\uff01")},3E3)};k.onReconnect=function(a,c){};g=d.subscribe(k);this.sendMessage=function(a){if(!g.request.isOpen)return f("E\u8baf\u5df2\u65ad\u5f00\u8fde\u63a5\uff0c\u65e0\u6cd5\u53d1\u9001\u6d88\u606f\uff01"),!1;g.push(a);return!0};this.isConnect=function(){return g.request.isOpen};this.close=function(){d.unsubscribe()};this.uid=c}(function(c,a){var d=a("#top-right-content"),d=a(".top-right",d),g=a(".remind-num",d),h=a(".remind-msg-num",d),k=a("#msgcenter-sound"),e=document.getElementById("msgcenter-sound-audio");c.NewMessageRemind=function(a){var b=function(a){return 99<a?"99+":0>=a?"":a+""},c=!1,d,f;a.msgRemindNum?(f=parseInt(a.msgRemindNum),d=parseInt(g.text())||0,f>d&&(c=!0),g.text(b(f))):g.text("");a.msgAttentionNum?(f=parseInt(a.msgAttentionNum),c||(d=parseInt($attentionNum.text())||0,f>d&&(c=!0)),$attentionNum.text(b(f))):$attentionNum.text("");a.msgEMsgNum?(f=parseInt(a.msgEMsgNum),c||(d=parseInt(h.text())||0,f>d&&(c=!0)),h.text(b(f))):h.text("");c?(k.length?k[0].src=Util.getRightUrl(SOUND_URL+"?_\x3d"+ +new Date):e&&e.play(),docTitle.roll()):docTitle.stop()};c.OpenEMsg=function(a,c,d){eMsg?"undefined"==typeof c?eMsg.open(a):eMsg.openSession(a,c,d):Util.loadPageModule({templ:"fui/pages/emsg/emsg.tpl",js:"fui/pages/emsg/emsg.js",css:"fui/pages/emsg/emsg.css",callback:function(){eMsg=new EMsgDialog;"undefined"==typeof c?eMsg.open(a):eMsg.openSession(a,c,d)}})};var f={};c.MsgNotify=function(a){var b=a.sessiontype,c;c="friend"==b?{query:"getuserinfo",uid:a.from_uid}:{query:"getgroupinfo",uid:a.sessionid};if("undefined"==typeof f[c.uid])Util.ajax({url:EmsgConfig.baseUrl,data:c}).done(function(d){d.imgUrl="friend"==b?d.imgUrl||EmsgConfig.userImg:EmsgConfig.groupImg;f[c.uid]=d;WinNotify(d.name,{body:a.content,icon:d.imgUrl})}).fail(function(){});else{var d=f[c.uid];WinNotify(d.name,{body:a.content,icon:d.imgUrl})}};c.WinNotify=function(a,c,d){var b;"string"==typeof c&&(c={body:c});if("Notification"in window)"granted"===Notification.permission?b=new Notification(a,c):"denied"!==Notification.permission&&Notification.requestPermission(function(d){"granted"===d&&(b=new Notification(a,c))});else return!1;setTimeout(function(){b.close()},d||3E3)}})(this,jQuery);(function(c,a){var d,g="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01",h=0;c.docTitle={roll:function(){d||(d=document.title);document.title=g;clearTimeout(h);h=setTimeout(function e(){document.title=g.substring(1,g.length)+g.substring(0,1);g=document.title;h=setTimeout(e,300)},300)},stop:function(){clearTimeout(h);document.title=d||document.title;g="\u60a8\u6709\u65b0\u6d88\u606f\u63d0\u9192\uff0c\u8bf7\u70b9\u51fb\u67e5\u770b\uff01"}}})(window,jQuery);